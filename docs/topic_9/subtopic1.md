# Тема 9. Обробка винятків

## Поняття винятків

Виняток (exception) — це подія, яка виникає під час виконання програми і порушує її нормальний хід. Вона сигналізує про
помилку або нестандартну ситуацію, яку потрібно обробити, щоб програма не аварійно завершилася.

Винятки дозволяють:

- Виявляти помилки під час виконання.
- Локалізувати проблеми та реагувати на них без зупинки всієї програми.
- Підвищувати надійність і стабільність програмного забезпечення.

---

## Типові помилки

Найчастіше під час виконання програм виникають такі помилки:

**Поділ на нуль**  
При спробі поділити число на нуль виникає `DivideByZeroException`.

```csharp
int a = 10;
int b = 0;
int c = a / b; // DivideByZeroException
```

**Вихід за межі масиву**  
Коли звертаємося до неіснуючого індексу масиву — `IndexOutOfRangeException`.

```csharp
int[] arr = {1, 2, 3};
int value = arr[5]; // IndexOutOfRangeException
```

**Некоректне введення користувача**  
Наприклад, введення тексту замість числа викликає `FormatException`.

```csharp
int number = int.Parse(Console.ReadLine()); // FormatException якщо введено не число
```

---

## Конструкція `try...catch...finally`

Для обробки винятків у C# використовується конструкція `try...catch...finally`.

### Синтаксис:

```csharp
try
{
    // Код, який може викликати виняток
}
catch (ExceptionType ex)
{
    // Обробка винятку
}
finally
{
    // Код, який виконується завжди, незалежно від винятку
}
```

- **try** — містить код, який може викликати виняток.
- **catch** — перехоплює виняток і обробляє його. Можна перехоплювати конкретні типи винятків або загальний `Exception`.
- **finally** — виконується завжди, навіть якщо винятку не було. Зручно для закриття файлів, з’єднань з базою даних,
  звільнення ресурсів.

### Пояснення:

Конструкція дозволяє безпечно виконувати код, який може призвести до помилки, і реагувати на ці помилки зрозумілим для
користувача або програми способом.

### Приклад:

```csharp
try
{
    Console.Write("Введіть число: ");
    int number = int.Parse(Console.ReadLine());
    int result = 100 / number;
    Console.WriteLine("Результат: " + result);
}
catch (DivideByZeroException)
{
    Console.WriteLine("Помилка: Ділення на нуль!");
}
catch (FormatException)
{
    Console.WriteLine("Помилка: Некоректне введення!");
}
finally
{
    Console.WriteLine("Програма завершила обробку винятку.");
}
```

---

## Клас `Exception`

У C# всі винятки успадковуються від базового класу `System.Exception`.  
Основні властивості класу `Exception`:

- `Message` — повідомлення про помилку.
- `StackTrace` — інформація про стек викликів, де сталася помилка.
- `InnerException` — вкладений виняток (якщо він є).
- `Source` — джерело винятку.

```csharp
try
{
    int a = 10, b = 0;
    int c = a / b;
}
catch (Exception ex)
{
    Console.WriteLine($"Повідомлення: {ex.Message}");
    Console.WriteLine($"Стека викликів: {ex.StackTrace}");
}

```

---

## Викидання власних винятків

Можна створювати та викидати власні винятки за допомогою `throw`.

### Приклад:

```csharp
int age = -5;

if (age < 0)
{
    throw new ArgumentException("Вік не може бути від’ємним!");
}
```

Також можна створювати власні класи винятків, успадковуючи Exception:

```csharp
class MyCustomException : Exception
{
    public MyCustomException(string message) : base(message) { }
}

throw new MyCustomException("Це мій власний виняток!");

```

### Пояснення:

- Можна кидати винятки при специфічних умовах у програмі, наприклад, коли введені некоректні дані.
- Можна створювати власні класи винятків, успадковуючи базовий клас `Exception`. Це дозволяє більш точно описати помилку
  та її причину.

---

## Значення обробки винятків

Обробка винятків є ключовим елементом створення **надійних і стабільних програм**. Основні переваги:

1. Програма не аварійно завершується при виникненні помилки.
2. Дозволяє повідомляти користувача про проблему в зрозумілій формі.
3. Забезпечує можливість логування та відстеження помилок.
4. Полегшує тестування та підтримку програмного забезпечення.
5. Дає можливість контролювати ресурси — наприклад, закривати файли або відключати з’єднання.

---

### Підсумок

- Винятки — це засіб обробки помилок під час виконання програми.
- Основні типові помилки: поділ на нуль, вихід за межі масиву, некоректне введення.
- Конструкція `try...catch...finally` дозволяє безпечно обробляти винятки.
- Клас `Exception` — базовий для всіх винятків.
- Можна викидати власні винятки для специфічних ситуацій.
- Обробка винятків робить програми більш надійними та стійкими.
